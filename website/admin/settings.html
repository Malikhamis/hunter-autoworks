<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Settings ‚Äî Hunter Auto</title>
  <style>html{visibility:hidden}html.page-ready{visibility:visible}</style>
  <link rel="preload" href="styles-clean.css" as="style" onload="this.rel='stylesheet';document.documentElement.classList.add('page-ready')">
  <noscript><link rel="stylesheet" href="styles-clean.css"></noscript>
    <script>
      // Apply dark mode immediately to prevent flash
      if (localStorage.getItem('appSettings')) {
        const settings = JSON.parse(localStorage.getItem('appSettings'));
        if (settings.darkMode) {
          document.addEventListener('DOMContentLoaded', function() {
            document.body.classList.add('dark-mode');
          });
        }
      }
    </script>
  </head>
  <body>
    <div class="app-shell">
      <aside class="sidebar" role="navigation">
        <div class="brand"><div style="font-weight:900">Hunter Auto</div><div class="small">Admin</div></div>
        <nav class="nav">
          <a href="dashboard.html">Dashboard</a>
          <a href="documents.html">Documents</a>
          <a href="invoices.html">Invoices</a>
          <a href="clients.html">Clients</a>
          <a href="services.html">Services</a>
          <a href="reports.html">Reports</a>
          <a href="settings.html" class="active">Settings</a>
        </nav>
      </aside>

      <main class="main-area">
        <header class="topbar">
          <div class="left">
            <button id="hamburger" class="hamburger" aria-label="Open menu" aria-expanded="false">‚ò∞</button>
            <h1>Settings</h1>
          </div>
          <div class="actions">
            <button id="save-settings" class="action-btn" style="background: var(--gradient-success);">
              üíæ Save Changes
            </button>
          </div>
        </header>
        
        <div class="container" style="padding: 24px; max-width: 1400px; width: 100%;">
          <h2 style="font-size: 1.75rem; font-weight: 800; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 24px;">
            ‚öôÔ∏è Application Settings
          </h2>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
            <!-- Left Column -->
            <div style="display: flex; flex-direction: column; gap: 24px;">
              
              <!-- Business Profile -->
              <div class="card" style="padding: 24px;">
                <h3 style="font-size: 1.125rem; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                  üè¢ Business Profile
                </h3>
                
                <div style="display: flex; flex-direction: column; gap: 16px;">
                  <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">Business Name</label>
                    <input type="text" id="businessName" value="Hunter Autoworks" style="width: 100%; padding: 10px 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.875rem; transition: var(--transition-base);"
                      onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(0,178,255,0.1)'"
                      onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'" />
                  </div>
                  
                  <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">Email Address</label>
                    <input type="email" id="businessEmail" value="info@hunterauto.com" style="width: 100%; padding: 10px 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.875rem; transition: var(--transition-base);"
                      onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(0,178,255,0.1)'"
                      onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'" />
                  </div>
                  
                  <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">Phone Number</label>
                    <input type="tel" id="businessPhone" value="+255 123 456 789" style="width: 100%; padding: 10px 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.875rem; transition: var(--transition-base);"
                      onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(0,178,255,0.1)'"
                      onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'" />
                  </div>
                  
                  <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">Business Address</label>
                    <textarea id="businessAddress" rows="3" style="width: 100%; padding: 10px 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.875rem; resize: vertical; transition: var(--transition-base);"
                      onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(0,178,255,0.1)'"
                      onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">123 Main Street, Dar es Salaam, Tanzania</textarea>
                  </div>
                </div>
              </div>
              
              <!-- Invoice Settings -->
              <div class="card" style="padding: 24px;">
                <h3 style="font-size: 1.125rem; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                  üìÑ Invoice Defaults
                </h3>
                
                <div style="display: flex; flex-direction: column; gap: 16px;">
                  <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">Tax Rate (%)</label>
                    <input type="number" id="taxRate" value="18" min="0" max="100" step="0.1" style="width: 100%; padding: 10px 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.875rem; transition: var(--transition-base);"
                      onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(0,178,255,0.1)'"
                      onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'" />
                  </div>
                  
                  <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">Currency</label>
                    <select id="currency" style="width: 100%; padding: 10px 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.875rem; transition: var(--transition-base);"
                      onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(0,178,255,0.1)'"
                      onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                      <option value="TSh">Tanzanian Shilling (TSh)</option>
                      <option value="USD">US Dollar ($)</option>
                      <option value="EUR">Euro (‚Ç¨)</option>
                    </select>
                  </div>
                  
                  <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">Payment Terms (days)</label>
                    <input type="number" id="paymentTerms" value="30" min="1" max="365" style="width: 100%; padding: 10px 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.875rem; transition: var(--transition-base);"
                      onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(0,178,255,0.1)'"
                      onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'" />
                  </div>
                  
                  <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">Invoice Prefix</label>
                    <input type="text" id="invoicePrefix" value="INV-" style="width: 100%; padding: 10px 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.875rem; transition: var(--transition-base);"
                      onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(0,178,255,0.1)'"
                      onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'" />
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Right Column -->
            <div style="display: flex; flex-direction: column; gap: 24px;">
              
              <!-- Supabase Configuration -->
              <div class="card" style="padding: 24px;">
                <h3 style="font-size: 1.125rem; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                  üîå Supabase Connection
                </h3>
                
                <div style="display: flex; flex-direction: column; gap: 16px;">
                  <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">Supabase URL</label>
                    <input type="url" id="supabaseUrl" placeholder="https://your-project.supabase.co" style="width: 100%; padding: 10px 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.875rem; transition: var(--transition-base);"
                      onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(0,178,255,0.1)'"
                      onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'" />
                  </div>
                  
                  <div>
                    <label style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">Anon Key</label>
                    <input type="password" id="supabaseKey" placeholder="eyJhbGciOi..." style="width: 100%; padding: 10px 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.875rem; font-family: monospace; transition: var(--transition-base);"
                      onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(0,178,255,0.1)'"
                      onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'" />
                  </div>
                  
                  <div style="display: flex; gap: 8px; margin-top: 8px;">
                    <button id="test-connection" style="flex: 1; padding: 10px 16px; background: var(--gradient-primary); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.875rem; cursor: pointer; transition: var(--transition-base);"
                      onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-md)'"
                      onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                      üîç Test Connection
                    </button>
                  </div>
                  
                  <div id="connection-status" style="display: none; padding: 12px; border-radius: 8px; font-size: 0.875rem; font-weight: 600;"></div>
                </div>
              </div>
              
              <!-- Application Preferences -->
              <div class="card" style="padding: 24px;">
                <h3 style="font-size: 1.125rem; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                  üé® Application Preferences
                </h3>
                
                <div style="display: flex; flex-direction: column; gap: 20px;">
                  <div class="toggle-setting">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div>
                        <div style="font-weight: 600; font-size: 0.875rem; margin-bottom: 4px;">üåô Dark Mode</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">Switch to dark theme</div>
                      </div>
                      <label class="toggle-switch">
                        <input type="checkbox" id="darkMode">
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>
                  
                  <div class="toggle-setting">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div>
                        <div style="font-weight: 600; font-size: 0.875rem; margin-bottom: 4px;">üîî Notifications</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">Enable browser notifications</div>
                      </div>
                      <label class="toggle-switch">
                        <input type="checkbox" id="notifications" checked>
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>
                  
                  <div class="toggle-setting">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div>
                        <div style="font-weight: 600; font-size: 0.875rem; margin-bottom: 4px;">üíæ Auto-Save</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">Automatically save changes</div>
                      </div>
                      <label class="toggle-switch">
                        <input type="checkbox" id="autoSave" checked>
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>
                  
                  <div class="toggle-setting">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div>
                        <div style="font-weight: 600; font-size: 0.875rem; margin-bottom: 4px;">üîÑ Auto-Sync</div>
                        <div style="font-size: 0.75rem; color: var(--text-secondary);">Sync with Supabase automatically</div>
                      </div>
                      <label class="toggle-switch">
                        <input type="checkbox" id="autoSync">
                        <span class="toggle-slider"></span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Danger Zone -->
              <div class="card" style="padding: 24px; border-left: 4px solid var(--danger);">
                <h3 style="font-size: 1.125rem; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 8px; color: var(--danger);">
                  ‚ö†Ô∏è Danger Zone
                </h3>
                
                <div style="display: flex; flex-direction: column; gap: 12px;">
                  <button onclick="clearCache()" style="width: 100%; padding: 10px 16px; background: white; border: 2px solid var(--danger); color: var(--danger); border-radius: 8px; font-weight: 600; font-size: 0.875rem; cursor: pointer; transition: var(--transition-base); text-align: left;"
                    onmouseover="this.style.background='var(--danger)'; this.style.color='white'"
                    onmouseout="this.style.background='white'; this.style.color='var(--danger)'">
                    üóëÔ∏è Clear Cache & Local Data
                  </button>
                  
                  <button onclick="resetSettings()" style="width: 100%; padding: 10px 16px; background: white; border: 2px solid var(--warning); color: var(--warning); border-radius: 8px; font-weight: 600; font-size: 0.875rem; cursor: pointer; transition: var(--transition-base); text-align: left;"
                    onmouseover="this.style.background='var(--warning)'; this.style.color='white'"
                    onmouseout="this.style.background='white'; this.style.color='var(--warning)'">
                    üîÑ Reset to Default Settings
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobileOverlay" class="mobile-overlay"></div>

    <script src="admin.js"></script>
    <script>
      // Settings management
      document.addEventListener('DOMContentLoaded', () => {
        loadSettings();
        setupEventListeners();
        
        // Apply dark mode if it was enabled
        const settings = JSON.parse(localStorage.getItem('appSettings') || '{}');
        if (settings.darkMode) {
          document.body.classList.add('dark-mode');
        }
      });
      
      function setupEventListeners() {
        document.getElementById('save-settings').addEventListener('click', saveSettings);
        document.getElementById('test-connection').addEventListener('click', testSupabaseConnection);
        
        // Dark mode toggle listener
        document.getElementById('darkMode').addEventListener('change', function() {
          toggleDarkMode(this.checked);
        });
        
        // Other preference toggles with auto-save
        document.getElementById('notifications').addEventListener('change', autoSavePreference);
        document.getElementById('autoSave').addEventListener('change', autoSavePreference);
        document.getElementById('autoSync').addEventListener('change', autoSavePreference);
      }
      
      function toggleDarkMode(enabled) {
        if (enabled) {
          document.body.classList.add('dark-mode');
          showNotification('üåô Dark mode enabled', 'success');
        } else {
          document.body.classList.remove('dark-mode');
          showNotification('‚òÄÔ∏è Light mode enabled', 'success');
        }
        
        // Save to localStorage
        const settings = JSON.parse(localStorage.getItem('appSettings') || '{}');
        settings.darkMode = enabled;
        localStorage.setItem('appSettings', JSON.stringify(settings));
      }
      
      function autoSavePreference() {
        const settings = JSON.parse(localStorage.getItem('appSettings') || '{}');
        settings.notifications = document.getElementById('notifications').checked;
        settings.autoSave = document.getElementById('autoSave').checked;
        settings.autoSync = document.getElementById('autoSync').checked;
        localStorage.setItem('appSettings', JSON.stringify(settings));
      }
      
      function loadSettings() {
        const settings = JSON.parse(localStorage.getItem('appSettings') || '{}');
        
        // Load business profile
        if (settings.businessName) document.getElementById('businessName').value = settings.businessName;
        if (settings.businessEmail) document.getElementById('businessEmail').value = settings.businessEmail;
        if (settings.businessPhone) document.getElementById('businessPhone').value = settings.businessPhone;
        if (settings.businessAddress) document.getElementById('businessAddress').value = settings.businessAddress;
        
        // Load invoice defaults
        if (settings.taxRate) document.getElementById('taxRate').value = settings.taxRate;
        if (settings.currency) document.getElementById('currency').value = settings.currency;
        if (settings.paymentTerms) document.getElementById('paymentTerms').value = settings.paymentTerms;
        if (settings.invoicePrefix) document.getElementById('invoicePrefix').value = settings.invoicePrefix;
        
        // Load Supabase config
        if (settings.supabaseUrl) document.getElementById('supabaseUrl').value = settings.supabaseUrl;
        if (settings.supabaseKey) document.getElementById('supabaseKey').value = settings.supabaseKey;
        
        // Load preferences
        document.getElementById('darkMode').checked = settings.darkMode || false;
        document.getElementById('notifications').checked = settings.notifications !== false;
        document.getElementById('autoSave').checked = settings.autoSave !== false;
        document.getElementById('autoSync').checked = settings.autoSync || false;
      }
      
      function saveSettings() {
        const settings = {
          businessName: document.getElementById('businessName').value,
          businessEmail: document.getElementById('businessEmail').value,
          businessPhone: document.getElementById('businessPhone').value,
          businessAddress: document.getElementById('businessAddress').value,
          taxRate: document.getElementById('taxRate').value,
          currency: document.getElementById('currency').value,
          paymentTerms: document.getElementById('paymentTerms').value,
          invoicePrefix: document.getElementById('invoicePrefix').value,
          supabaseUrl: document.getElementById('supabaseUrl').value,
          supabaseKey: document.getElementById('supabaseKey').value,
          darkMode: document.getElementById('darkMode').checked,
          notifications: document.getElementById('notifications').checked,
          autoSave: document.getElementById('autoSave').checked,
          autoSync: document.getElementById('autoSync').checked,
          lastUpdated: new Date().toISOString()
        };
        
        localStorage.setItem('appSettings', JSON.stringify(settings));
        
        // Show success notification
        showNotification('‚úÖ Settings saved successfully!', 'success');
      }
      
      function testSupabaseConnection() {
        const url = document.getElementById('supabaseUrl').value;
        const key = document.getElementById('supabaseKey').value;
        const statusDiv = document.getElementById('connection-status');
        
        if (!url || !key) {
          statusDiv.style.display = 'block';
          statusDiv.style.background = 'var(--warning-light)';
          statusDiv.style.color = 'var(--warning)';
          statusDiv.textContent = '‚ö†Ô∏è Please enter both URL and Anon Key';
          return;
        }
        
        statusDiv.style.display = 'block';
        statusDiv.style.background = 'var(--primary-50)';
        statusDiv.style.color = 'var(--primary)';
        statusDiv.textContent = 'üîÑ Testing connection...';
        
        // Simulate connection test
        setTimeout(() => {
          const isValid = url.includes('supabase.co') && key.length > 50;
          
          if (isValid) {
            statusDiv.style.background = 'var(--success-light)';
            statusDiv.style.color = 'var(--success)';
            statusDiv.textContent = '‚úÖ Connection successful!';
          } else {
            statusDiv.style.background = 'var(--danger-light)';
            statusDiv.style.color = 'var(--danger)';
            statusDiv.textContent = '‚ùå Connection failed. Please check your credentials.';
          }
        }, 1500);
      }
      
      function clearCache() {
        if (confirm('‚ö†Ô∏è This will clear all cached data and local storage. Are you sure?')) {
          localStorage.clear();
          sessionStorage.clear();
          showNotification('üóëÔ∏è Cache and local data cleared!', 'warning');
          setTimeout(() => location.reload(), 1500);
        }
      }
      
      function resetSettings() {
        if (confirm('‚ö†Ô∏è This will reset all settings to default values. Continue?')) {
          localStorage.removeItem('appSettings');
          showNotification('üîÑ Settings reset to defaults!', 'warning');
          setTimeout(() => location.reload(), 1500);
        }
      }
      
      function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.style.position = 'fixed';
        notification.style.top = '24px';
        notification.style.right = '24px';
        notification.style.padding = '16px 24px';
        notification.style.borderRadius = '12px';
        notification.style.fontWeight = '600';
        notification.style.fontSize = '0.875rem';
        notification.style.zIndex = '10000';
        notification.style.boxShadow = 'var(--shadow-xl)';
        notification.style.animation = 'slideInRight 0.3s ease-out';
        notification.textContent = message;
        
        if (type === 'success') {
          notification.style.background = 'var(--success-light)';
          notification.style.color = 'var(--success)';
        } else if (type === 'warning') {
          notification.style.background = 'var(--warning-light)';
          notification.style.color = 'var(--warning)';
        } else if (type === 'error') {
          notification.style.background = 'var(--danger-light)';
          notification.style.color = 'var(--danger)';
        }
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.style.animation = 'slideOutRight 0.3s ease-in';
          setTimeout(() => notification.remove(), 300);
        }, 3000);
      }
      
      // Add animation styles
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideInRight {
          from {
            transform: translateX(400px);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
        
        @keyframes slideOutRight {
          from {
            transform: translateX(0);
            opacity: 1;
          }
          to {
            transform: translateX(400px);
            opacity: 0;
          }
        }
        
        @media (max-width: 1024px) {
          .container > div[style*="grid-template-columns: 1fr 1fr"] {
            grid-template-columns: 1fr !important;
          }
        }
      `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
