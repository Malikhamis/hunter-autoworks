<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Documents ‚Äî Hunter Auto</title>
  <style>html{visibility:hidden}html.page-ready{visibility:visible}</style>
  <link rel="preload" href="styles-clean.css" as="style" onload="this.rel='stylesheet';document.documentElement.classList.add('page-ready')">
  <noscript><link rel="stylesheet" href="styles-clean.css"></noscript>
    <script>
      // Apply dark mode immediately to prevent flash
      if (localStorage.getItem('appSettings')) {
        const settings = JSON.parse(localStorage.getItem('appSettings'));
        if (settings.darkMode) {
          document.addEventListener('DOMContentLoaded', function() {
            document.body.classList.add('dark-mode');
          });
        }
      }
    </script>
  </head>
  <body>
    <div class="app-shell">
      <aside class="sidebar" role="navigation" aria-label="Main navigation">
        <div class="brand">
          <img src="../images/logo.jpg" alt="logo" width="36" height="36" onerror="this.style.display='none'" />
          <div>
            <div style="font-weight:900">Hunter Auto</div>
            <div class="small">Admin</div>
          </div>
        </div>

        <nav class="nav">
          <a href="dashboard.html">Dashboard</a>
          <a href="documents.html" class="active">Documents</a>
          <a href="invoices.html">Invoices</a>
          <a href="clients.html">Clients</a>
          <a href="services.html">Services</a>
          <a href="reports.html">Reports</a>
          <a href="settings.html">Settings</a>
        </nav>

        <div class="small">v1.0 ¬∑ Local-first ¬∑ Supabase</div>
      </aside>

      <main class="main-area">
        <header class="topbar">
          <div class="left">
            <button id="hamburger" class="hamburger" aria-label="Open menu" aria-expanded="false">‚ò∞</button>
            <h1>Documents</h1>
          </div>
          <div class="actions"><button id="btn-new-doc" class="action-btn">üìÑ New</button></div>
        </header>
        
        <div class="container" style="padding: 24px; max-width: 1600px; width: 100%;">
          <h2 style="font-size: 1.75rem; font-weight: 800; background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 24px;">
            üìÅ Document Manager
          </h2>
          
          <div style="display: grid; grid-template-columns: 280px 1fr; gap: 24px; align-items: start;">
            <!-- Left: Filter Panel -->
            <div class="card" style="padding: 20px; position: sticky; top: 24px;">
              <h3 style="font-size: 1rem; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                üîç Filter Documents
              </h3>
              
              <div style="display: flex; flex-direction: column; gap: 12px;">
                <div>
                  <label style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">Document Type</label>
                  <select id="filterType" style="width: 100%; padding: 8px 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.875rem; transition: var(--transition-base);"
                    onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(0,178,255,0.1)'"
                    onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                    <option value="all">All Types</option>
                    <option value="invoice">Invoice</option>
                    <option value="estimate">Estimate</option>
                    <option value="quotation">Quotation</option>
                    <option value="proforma">Proforma</option>
                  </select>
                </div>
                
                <div>
                  <label style="display: block; font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">Sync Status</label>
                  <select id="filterStatus" style="width: 100%; padding: 8px 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.875rem; transition: var(--transition-base);"
                    onfocus="this.style.borderColor='var(--primary)'; this.style.boxShadow='0 0 0 3px rgba(0,178,255,0.1)'"
                    onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                    <option value="all">All Status</option>
                    <option value="synced">Synced</option>
                    <option value="local">Local Only</option>
                  </select>
                </div>
                
                <button id="applyFilter" style="margin-top: 8px; padding: 10px 16px; background: var(--gradient-primary); color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.875rem; cursor: pointer; transition: var(--transition-base);"
                  onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='var(--shadow-lg)'"
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                  Apply Filters
                </button>
                
                <button id="clearFilter" style="padding: 8px 16px; background: transparent; color: var(--text-secondary); border: 1px solid var(--border); border-radius: 8px; font-weight: 600; font-size: 0.875rem; cursor: pointer; transition: var(--transition-base);"
                  onmouseover="this.style.borderColor='var(--primary)'; this.style.color='var(--primary)'"
                  onmouseout="this.style.borderColor='var(--border)'; this.style.color='var(--text-secondary)'">
                  Clear All
                </button>
              </div>
              
              <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);">
                <div style="font-size: 0.75rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 8px;">STATISTICS</div>
                <div id="docStats" style="display: flex; flex-direction: column; gap: 8px; font-size: 0.875rem;">
                  <div style="display: flex; justify-content: space-between;">
                    <span>Total:</span>
                    <span id="statTotal" style="font-weight: 700; color: var(--primary);">0</span>
                  </div>
                  <div style="display: flex; justify-content: space-between;">
                    <span>Synced:</span>
                    <span id="statSynced" style="font-weight: 700; color: var(--success);">0</span>
                  </div>
                  <div style="display: flex; justify-content: space-between;">
                    <span>Local:</span>
                    <span id="statLocal" style="font-weight: 700; color: var(--warning);">0</span>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Right: Documents Grid -->
            <div>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div style="font-size: 0.875rem; color: var(--text-secondary);">
                  <span id="docCount">0 documents</span>
                </div>
                <div style="display: flex; gap: 8px;">
                  <button id="viewGrid" class="view-toggle active" style="padding: 6px 12px; border: 1px solid var(--border); border-radius: 6px; background: white; cursor: pointer; transition: var(--transition-base);">
                    üìä Grid
                  </button>
                  <button id="viewList" class="view-toggle" style="padding: 6px 12px; border: 1px solid var(--border); border-radius: 6px; background: white; cursor: pointer; transition: var(--transition-base);">
                    üìã List
                  </button>
                </div>
              </div>
              
              <div id="documents-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 16px;"></div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobileOverlay" class="mobile-overlay"></div>

    <script src="admin.js"></script>
    <script>
      // Enhanced document rendering with filtering and statistics
      let allDocuments = [];
      let currentFilter = { type: 'all', status: 'all' };
      let currentView = 'grid';
      
      // Initialize on page load
      document.addEventListener('DOMContentLoaded', () => {
        loadAndRenderDocuments();
        setupEventListeners();
      });
      
      function setupEventListeners() {
        document.getElementById('btn-new-doc').addEventListener('click', () => {
          if (typeof openDocumentEditor === 'function') {
            openDocumentEditor();
          } else {
            alert('Open new document editor (TBD)');
          }
        });
        
        document.getElementById('applyFilter').addEventListener('click', applyFilters);
        document.getElementById('clearFilter').addEventListener('click', clearFilters);
        document.getElementById('viewGrid').addEventListener('click', () => switchView('grid'));
        document.getElementById('viewList').addEventListener('click', () => switchView('list'));
      }
      
      function loadAndRenderDocuments() {
        if (typeof getDocuments === 'function') {
          allDocuments = getDocuments().slice().reverse();
        } else {
          allDocuments = [];
        }
        renderDocuments();
        updateStats();
      }
      
      function applyFilters() {
        currentFilter.type = document.getElementById('filterType').value;
        currentFilter.status = document.getElementById('filterStatus').value;
        renderDocuments();
      }
      
      function clearFilters() {
        currentFilter = { type: 'all', status: 'all' };
        document.getElementById('filterType').value = 'all';
        document.getElementById('filterStatus').value = 'all';
        renderDocuments();
      }
      
      function switchView(view) {
        currentView = view;
        document.querySelectorAll('.view-toggle').forEach(btn => {
          btn.classList.remove('active');
          btn.style.background = 'white';
          btn.style.color = 'var(--text-primary)';
        });
        
        const activeBtn = view === 'grid' ? document.getElementById('viewGrid') : document.getElementById('viewList');
        activeBtn.classList.add('active');
        activeBtn.style.background = 'var(--gradient-primary)';
        activeBtn.style.color = 'white';
        
        renderDocuments();
      }
      
      function renderDocuments() {
        const grid = document.getElementById('documents-grid');
        if (!grid) return;
        
        // Filter documents
        let filtered = allDocuments.filter(doc => {
          const typeMatch = currentFilter.type === 'all' || (doc.type || 'invoice') === currentFilter.type;
          const statusMatch = currentFilter.status === 'all' || 
            (currentFilter.status === 'synced' && doc.synced) ||
            (currentFilter.status === 'local' && !doc.synced);
          return typeMatch && statusMatch;
        });
        
        // Update count
        document.getElementById('docCount').textContent = `${filtered.length} document${filtered.length !== 1 ? 's' : ''}`;
        
        if (!filtered.length) {
          grid.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--text-secondary);">
              <div style="font-size: 3rem; margin-bottom: 16px;">üì≠</div>
              <div style="font-size: 1.125rem; font-weight: 600; margin-bottom: 8px;">No documents found</div>
              <div style="font-size: 0.875rem; margin-bottom: 20px;">Try adjusting your filters or create a new document</div>
              <button onclick="document.getElementById('btn-new-doc').click()" style="padding: 10px 20px; background: var(--gradient-primary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                üìÑ Create Document
              </button>
            </div>
          `;
          return;
        }
        
        // Render based on view mode
        if (currentView === 'grid') {
          grid.style.display = 'grid';
          grid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(340px, 1fr))';
          grid.innerHTML = filtered.map((doc, index) => renderDocumentCard(doc, index)).join('');
        } else {
          grid.style.display = 'flex';
          grid.style.flexDirection = 'column';
          grid.innerHTML = filtered.map((doc, index) => renderDocumentListItem(doc, index)).join('');
        }
      }
      
      function renderDocumentCard(doc, index) {
        const when = new Date(doc.date || doc.createdAt || Date.now()).toLocaleDateString();
        const typeLabel = (doc.type || 'invoice').toUpperCase();
        const total = (doc.services || []).reduce((s, i) => s + (i.price || i.amount || 0), 0);
        const typeIcon = getDocTypeIcon(doc.type || 'invoice');
        const statusBadge = doc.synced 
          ? '<span style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--success-light); color: var(--success); border-radius: 12px; font-size: 0.75rem; font-weight: 600;"><span style="width: 6px; height: 6px; background: var(--success); border-radius: 50%; box-shadow: 0 0 6px var(--success);"></span>Synced</span>'
          : '<span style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--warning-light); color: var(--warning); border-radius: 12px; font-size: 0.75rem; font-weight: 600;"><span style="width: 6px; height: 6px; background: var(--warning); border-radius: 50%; box-shadow: 0 0 6px var(--warning);"></span>Local</span>';
        
        return `
          <article class="card document-card" style="padding: 0; border-radius: 12px; overflow: hidden; transition: var(--transition-base); cursor: pointer; animation: slideInUp 0.4s ease-out backwards; animation-delay: ${index * 0.05}s;"
            onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='var(--shadow-xl)'"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-md)'">
            
            <div style="background: var(--gradient-primary); padding: 16px; color: white;">
              <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                <div style="font-size: 2rem;">${typeIcon}</div>
                ${statusBadge}
              </div>
              <div style="font-size: 0.75rem; font-weight: 600; letter-spacing: 0.5px; opacity: 0.9;">${typeLabel}</div>
              <div style="font-size: 1.125rem; font-weight: 800; margin-top: 4px;">#${doc.id}</div>
            </div>
            
            <div style="padding: 16px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <div>
                  <div style="font-size: 0.875rem; font-weight: 700; color: var(--text-primary);">üë§ ${doc.customer || 'N/A'}</div>
                  <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 4px;">üìÖ ${when}</div>
                </div>
                <div style="text-align: right;">
                  <div style="font-size: 0.75rem; color: var(--text-secondary);">Total Amount</div>
                  <div style="font-size: 1.25rem; font-weight: 800; color: var(--primary); margin-top: 2px;">
                    TSh ${Number(total).toLocaleString()}
                  </div>
                </div>
              </div>
              
              <div style="display: flex; gap: 8px; margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border);">
                <button onclick="event.stopPropagation(); viewDocument('${doc.id}')" style="flex: 1; padding: 8px 12px; background: white; border: 1px solid var(--border); border-radius: 6px; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: var(--transition-base);"
                  onmouseover="this.style.borderColor='var(--primary)'; this.style.color='var(--primary)'"
                  onmouseout="this.style.borderColor='var(--border)'; this.style.color='var(--text-primary)'">
                  üëÅÔ∏è View
                </button>
                <button onclick="event.stopPropagation(); openDocumentEditor('${doc.id}')" style="flex: 1; padding: 8px 12px; background: var(--gradient-primary); color: white; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: var(--transition-base);"
                  onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='var(--shadow-md)'"
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                  ‚úèÔ∏è Edit
                </button>
                <button onclick="event.stopPropagation(); exportDocumentHTML('${doc.id}')" style="padding: 8px 12px; background: var(--gradient-success); color: white; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: var(--transition-base);"
                  onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='var(--shadow-md)'"
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                  üì§
                </button>
              </div>
            </div>
          </article>
        `;
      }
      
      function renderDocumentListItem(doc, index) {
        const when = new Date(doc.date || doc.createdAt || Date.now()).toLocaleDateString();
        const typeLabel = (doc.type || 'invoice').toUpperCase();
        const total = (doc.services || []).reduce((s, i) => s + (i.price || i.amount || 0), 0);
        const typeIcon = getDocTypeIcon(doc.type || 'invoice');
        const statusBadge = doc.synced 
          ? '<span style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--success-light); color: var(--success); border-radius: 12px; font-size: 0.75rem; font-weight: 600;"><span style="width: 6px; height: 6px; background: var(--success); border-radius: 50%;"></span>Synced</span>'
          : '<span style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--warning-light); color: var(--warning); border-radius: 12px; font-size: 0.75rem; font-weight: 600;"><span style="width: 6px; height: 6px; background: var(--warning); border-radius: 50%;"></span>Local</span>';
        
        return `
          <article class="card" style="padding: 16px; margin-bottom: 12px; display: grid; grid-template-columns: 48px 1fr auto auto; gap: 16px; align-items: center; transition: var(--transition-base); animation: slideInUp 0.4s ease-out backwards; animation-delay: ${index * 0.03}s;"
            onmouseover="this.style.transform='translateX(4px)'; this.style.boxShadow='var(--shadow-lg)'"
            onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='var(--shadow-md)'">
            
            <div style="font-size: 2.5rem;">${typeIcon}</div>
            
            <div>
              <div style="font-weight: 700; font-size: 1rem; margin-bottom: 4px;">
                <span style="color: var(--primary);">#${doc.id}</span> ‚Ä¢ ${typeLabel}
              </div>
              <div style="font-size: 0.875rem; color: var(--text-secondary);">
                üë§ ${doc.customer || 'N/A'} ‚Ä¢ üìÖ ${when}
              </div>
            </div>
            
            <div style="text-align: right;">
              <div style="font-size: 1.125rem; font-weight: 800; color: var(--primary); margin-bottom: 4px;">
                TSh ${Number(total).toLocaleString()}
              </div>
              ${statusBadge}
            </div>
            
            <div style="display: flex; gap: 8px;">
              <button onclick="viewDocument('${doc.id}')" style="padding: 8px 16px; background: white; border: 1px solid var(--border); border-radius: 6px; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: var(--transition-base);"
                onmouseover="this.style.borderColor='var(--primary)'; this.style.color='var(--primary)'"
                onmouseout="this.style.borderColor='var(--border)'; this.style.color='var(--text-primary)'">
                üëÅÔ∏è
              </button>
              <button onclick="openDocumentEditor('${doc.id}')" style="padding: 8px 16px; background: var(--gradient-primary); color: white; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: var(--transition-base);">
                ‚úèÔ∏è
              </button>
              <button onclick="exportDocumentHTML('${doc.id}')" style="padding: 8px 16px; background: var(--gradient-success); color: white; border: none; border-radius: 6px; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: var(--transition-base);">
                üì§
              </button>
            </div>
          </article>
        `;
      }
      
      function getDocTypeIcon(type) {
        const icons = {
          'invoice': 'üìÑ',
          'estimate': 'üìã',
          'quotation': 'üí∞',
          'proforma': 'üìù'
        };
        return icons[type] || 'üìÑ';
      }
      
      function updateStats() {
        const total = allDocuments.length;
        const synced = allDocuments.filter(d => d.synced).length;
        const local = total - synced;
        
        document.getElementById('statTotal').textContent = total;
        document.getElementById('statSynced').textContent = synced;
        document.getElementById('statLocal').textContent = local;
      }
      
      // Add slide-in animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideInUp {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
      `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
